<!doctype html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seller Dashboard - PropertyPlus</title>

    <!-- Bootstrap (you likely already use it) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- New dashboard base CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_base.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/add_property.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_updates.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fullscreen_viewer.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tools.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/filters.css') }}" />
</head>

<body class="pp-app pp-seller" data-user-id="{{ session.user.id if session.user else '' }}">
    <div class="pp-layout">
        <!-- Pass role for sidebar rendering -->
        {% set role = "Seller" %} {% include "components/_sidebar.html" with
        context %}

        <main class="pp-main">
            <header class="pp-topbar">
                <div></div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <!-- Add Property Button -->
                    <button class="btn btn-primary" id="headerAddPropertyBtn"
                        onclick="window.location.href='#tab-add-property'; document.querySelectorAll('.tab-content').forEach(t => t.style.display='none'); document.getElementById('tab-add-property').style.display='block';">
                        <i class="fas fa-plus"></i><span class="pp-add-text">Add Property</span>
                    </button>

                    <button class="pp-notify-btn" type="button" aria-label="Notifications" id="sellerNotifyBtn"
                        onclick="openNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="pp-notify-badge" id="notifyBadge"
                            {% if not unread_count or unread_count <= 0 %}style="display: none;"{% endif %}>{{
                            unread_count if unread_count else 0 }}</span>
                    </button>
                </div>
            </header>

            <!-- Tabs -->
            <section class="pp-content">
                <div id="tab-home" class="tab-content">
                    {% include "dashboard/components/_search_header.html" %}

                    <!-- Page content (under sticky header) -->
                    <div class="pp-page-body">
                        <!-- Results Header + View Toggle -->
                        <div class="pp-results-head">
                            <div class="pp-results-title">
                                {% if request.args.get('q') %}
                                Search Results for "{{ request.args.get('q') }}"
                                {% elif request.args.get('city') %}
                                Properties in {{ request.args.get('city') }}
                                {% elif request.args.get('state') %}
                                Properties in {{ request.args.get('state') }}
                                {% else %}
                                My Properties
                                {% endif %}
                            </div>

                            <div class="pp-view-toggle" role="group" aria-label="View toggle">
                                <button type="button" class="pp-view-btn active" data-view="grid"
                                    aria-label="Grid view">
                                    <i class="fas fa-border-all"></i>
                                </button>
                                <button type="button" class="pp-view-btn" data-view="list" aria-label="List view">
                                    <i class="fas fa-bars"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Results -->
                        <div class="pp-results" data-view="grid">
                            {% for prop in properties %}
                                {% include "dashboard/components/_property_card.html" %}
                            {% else %}
                            <div class="pp-empty-state">
                                <div class="pp-empty-icon-wrapper">
                                    <i class="fas fa-home"></i>
                                </div>
                                <h3>No Properties Listed</h3>
                                <p>Properties you list for sale or rent will appear here.</p>
                            </div>
                            {% endfor %}
                        </div>

                    </div>
                </div>

                <div id="tab-profile" class="tab-content">
                    {% include "components/_profile.html" %}
                </div>

                <div id="tab-add-property" class="tab-content">
                    {% include "dashboard/components/_add_property.html" %}
                </div>

                <div id="tab-requests" class="tab-content">
                    {% include "dashboard/components/_leads_panel.html" %}
                </div>

                <!-- =========================
                       HELP & SUPPORT
                       ========================= -->
                <div id="tab-help" class="tab-content" style="display: none">
                    {% include "dashboard/components/_help_support.html" %}
                </div>

                <div id="tab-settings" class="tab-content" style="display: none;">
                    <!-- Include New Settings Component -->
                    {% include "components/_settings.html" %}
                </div>

                <!-- =========================
                       TOOLS OVERVIEW
                       ========================= -->
                <div id="tab-tools" class="tab-content" style="display: none">
                    {% include "dashboard/components/_tools_overview.html" %}
                </div>

                <!-- =========================
                       BUDGET CALCULATOR
                       ========================= -->
                {% include "dashboard/components/_calculators.html" %}
            </section>
        </main>
    </div>

    {% include "dashboard/components/_property_modal.html" %}


    <div id="toastContainer" class="pp-toast-container"></div>

    {% include "dashboard/components/_edit_property_sidebar.html" %}

    <!-- DEDICATED DELETE MODAL (OUTSIDE SIDEBAR FOR BETTER UX) -->
    {% include "dashboard/components/_delete_property_modal.html" %}

    {% include "dashboard/components/_cancel_confirm_modal.html" %}

    <!-- Removed old password modal as per user request -->

    <script id="locationDataJson" type="application/json">{{ location_data|tojson }}</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard_base.js') }}"></script>
    <script src="{{ url_for('static', filename='js/seller.js') }}"></script>
    <script src="{{ url_for('static', filename='js/add_property.js') }}?v=2.0"></script>
    <script src="{{ url_for('static', filename='js/tools.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard_filters.js') }}"></script>
</body>

</html>